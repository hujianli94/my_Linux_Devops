<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.7. 使用iSCSI服务部署网络存储 &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.8. 远程登录Linux系统" href="7.%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95Linux%E7%B3%BB%E7%BB%9F.html" />
    <link rel="prev" title="2.6. Apache服务源码搭建" href="5.Apache%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> 小健_Linux-shell-Devops_Blog
            <img src="../../_static/devops_photo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../DevOps/index.html">DevOps和自动化运维实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Github/index.html">Github入门到实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Jenkins/index.html">Jenkins持续化集成</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../KVM/index.html">KVM实践</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01.%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%92%8C%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/index.html">1. 命令行和操作系统</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">2. Linux服务器架设</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="0.1RPM%E7%BA%A2%E5%B8%BD%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%AE%A1%E7%90%86.html">2.1. RPM软件包管理</a></li>
<li class="toctree-l3"><a class="reference internal" href="1.RAID%E4%B8%8ELVM%E7%A3%81%E7%9B%98%E9%98%B5%E5%88%97%E6%8A%80%E6%9C%AF.html">2.2. RAID与LVM磁盘阵列</a></li>
<li class="toctree-l3"><a class="reference internal" href="2.NFS%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA.html">2.3. NFS共享服务器搭建</a></li>
<li class="toctree-l3"><a class="reference internal" href="3.Vsftpd%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA.html">2.4. vsftpd服务安装配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="4.%E6%8C%82%E8%BD%BD%E7%A1%AC%E7%9B%98mount%E5%91%BD%E4%BB%A4.html">2.5. 挂载硬盘和分区</a></li>
<li class="toctree-l3"><a class="reference internal" href="5.Apache%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA.html">2.6. Apache服务源码搭建</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.7. 使用iSCSI服务部署网络存储</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#raid">2.7.1. 创建RAID磁盘阵列</a></li>
<li class="toctree-l4"><a class="reference internal" href="#iscsi-target-initiator">2.7.2. iSCSI技术在工作形式上分为服务端（target）与客户端（initiator）。</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="7.%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95Linux%E7%B3%BB%E7%BB%9F.html">2.8. 远程登录Linux系统</a></li>
<li class="toctree-l3"><a class="reference internal" href="8.Samba%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%90%AD%E5%BB%BA.html">2.9. Samba服务器搭建</a></li>
<li class="toctree-l3"><a class="reference internal" href="9.rsync%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5.html">2.10. rsync数据同步</a></li>
<li class="toctree-l3"><a class="reference internal" href="10.iptables%E4%B8%8Efirewalld%E9%98%B2%E7%81%AB%E5%A2%99.html">2.11. iptables与firewalld 防火墙</a></li>
<li class="toctree-l3"><a class="reference internal" href="11.Tomcat%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE.html">2.12. Tomcat服务搭建配置</a></li>
<li class="toctree-l3"><a class="reference internal" href="12.autofs%E8%87%AA%E5%8A%A8%E6%8C%82%E8%BD%BD%E6%9C%8D%E5%8A%A1.html">2.13. autofs自动挂载服务</a></li>
<li class="toctree-l3"><a class="reference internal" href="13.%E4%BD%BF%E7%94%A8Squid%E9%83%A8%E7%BD%B2%E4%BB%A3%E7%90%86%E7%BC%93%E5%AD%98%E6%9C%8D%E5%8A%A1.html">2.14. 使用Squid部署代理缓存服务</a></li>
<li class="toctree-l3"><a class="reference internal" href="14.Jenkins%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%BC%81%E4%B8%9A%E5%AE%9E%E6%88%98.html">2.15. Jenkins持续集成企业实战</a></li>
<li class="toctree-l3"><a class="reference internal" href="15.CentOS7%E5%AE%89%E8%A3%85xrdp%28windows%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E8%BF%9E%E6%8E%A5linux%29.html">2.16. CentOS7安装xrdp(windows远程桌面连接linux)</a></li>
<li class="toctree-l3"><a class="reference internal" href="16.Haproxy%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3.html">2.17. Haproxy负载均衡安装配置详解</a></li>
<li class="toctree-l3"><a class="reference internal" href="20.%E5%9B%BD%E5%86%85%E5%B8%B8%E4%BD%BF%E7%94%A8%E7%9A%84yum%E6%BA%90%E4%BF%A1%E6%81%AF.html">2.18. 国内常使用的yum源信息</a></li>
<li class="toctree-l3"><a class="reference internal" href="21.Centos7%E5%AE%89%E8%A3%85VNC%EF%BC%8C%E6%89%8B%E5%8A%A8%E7%BD%91%E7%BB%9C%E9%87%8D%E8%A3%85VPS.html">2.19. Centos7安装VNC，手动网络重装VPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="22.windows%E4%B8%8A%E6%90%AD%E5%BB%BAyum%E6%BA%90%E7%AB%99%E7%82%B9.html">2.20. windows上搭建yum源站点</a></li>
<li class="toctree-l3"><a class="reference internal" href="23.%E7%94%A8Python%E5%BF%AB%E9%80%9F%E5%AE%9E%E7%8E%B0HTTP%E5%92%8CFTP%E6%9C%8D%E5%8A%A1%E5%99%A8.html">2.21. 用 Python 快速实现 HTTP 和 FTP 服务器</a></li>
<li class="toctree-l3"><a class="reference internal" href="24.%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1nmtui.html">2.22. nmtui图形配置网络服务</a></li>
<li class="toctree-l3"><a class="reference internal" href="25.Openssh%E6%9B%B4%E6%96%B0%E5%8D%87%E7%BA%A7.html">2.23. Openssh更新升级</a></li>
<li class="toctree-l3"><a class="reference internal" href="26.rabbitmq%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2.html">2.24. rabbitmq服务部署</a></li>
<li class="toctree-l3"><a class="reference internal" href="27.Cobbler%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85.html">2.25. Cobbler无人值守安装</a></li>
<li class="toctree-l3"><a class="reference internal" href="28.Linux%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7Supervisor%28%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%29.html">2.26. Linux运维工具Supervisor(进程管理工具)</a></li>
<li class="toctree-l3"><a class="reference internal" href="29.%E7%9B%AE%E5%89%8D%E6%B5%81%E8%A1%8C%E7%9A%84%E5%BC%80%E6%BA%90%E7%9B%91%E6%8E%A7%E6%A1%86%E6%9E%B6.html">2.27. 目前流行的开源监控框架</a></li>
<li class="toctree-l3"><a class="reference internal" href="30.%E6%BA%90%E7%A0%81%E5%8C%85%E5%88%B6%E4%BD%9C%E6%88%90rpm%E5%8C%85.html">2.28. 源码包制作成rpm包</a></li>
<li class="toctree-l3"><a class="reference internal" href="31.Yum%E8%87%AA%E5%8A%A8%E4%B8%8B%E8%BD%BDRPM%E5%8C%85%E5%8F%8A%E5%85%B6%E6%89%80%E6%9C%89%E4%BE%9D%E8%B5%96%E7%9A%84%E5%8C%85.html">2.29. Yum自动下载RPM包及其所有依赖的包</a></li>
<li class="toctree-l3"><a class="reference internal" href="32.%E5%9F%BA%E4%BA%8EGalera_Cluster%E5%A4%9A%E4%B8%BB%E7%BB%93%E6%9E%84%E7%9A%84Mysql%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4.html">2.30. 基于Galera多主结构的Mysql高可用集群</a></li>
<li class="toctree-l3"><a class="reference internal" href="33.Gitlab%E5%AE%89%E8%A3%85.html">2.31. Gitlab安装</a></li>
<li class="toctree-l3"><a class="reference internal" href="34.Rsync%E6%95%B0%E6%8D%AE%E5%A4%8D%E5%88%B6%E8%BD%AF%E4%BB%B6%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5.html">2.32. Rsync数据复制软件应用实践</a></li>
<li class="toctree-l3"><a class="reference internal" href="35.Extundelete%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D.html">2.33. Extundelete 数据恢复</a></li>
<li class="toctree-l3"><a class="reference internal" href="36.Openvpn%E9%83%A8%E7%BD%B2.html">2.34. Openvpn部署</a></li>
<li class="toctree-l3"><a class="reference internal" href="37.CentOS8%E5%AE%89%E8%A3%85Docker%E5%92%8CDocker-componse.html">2.35. CentOS8 安装Docker和Docker-componse</a></li>
<li class="toctree-l3"><a class="reference internal" href="38.CentOS8%E5%BC%80%E5%90%AFBBR%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8.html">2.36. CentOS8开启BBR/升级内核</a></li>
<li class="toctree-l3"><a class="reference internal" href="39.Centos7%E9%80%9A%E8%BF%87python%2Bjs%E5%AE%9E%E7%8E%B0webssh.html">2.37. Centos7通过python+js实现webssh</a></li>
<li class="toctree-l3"><a class="reference internal" href="40.Centos7%E9%83%A8%E7%BD%B2NTP%E6%97%B6%E9%97%B4%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8C%E6%AD%A5%E7%8E%AF%E5%A2%83.html">2.38. Centos7部署NTP时间服务器同步环境</a></li>
<li class="toctree-l3"><a class="reference internal" href="41.Linux%E4%BC%98%E7%A7%80%E8%BD%AF%E4%BB%B6%E6%95%B4%E7%90%86.html">2.39. Linux优秀软件整理</a></li>
<li class="toctree-l3"><a class="reference internal" href="42.Centos7%E5%AE%89%E8%A3%85Openvpn.html">2.40. CentOS 7上设置和配置OpenVPN服务器</a></li>
<li class="toctree-l3"><a class="reference internal" href="43.ubuntu%E5%AE%89%E8%A3%85Power-shell.html">2.41. ubuntu18.04 安装power shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="44.Nginx%E6%95%B4%E5%90%88FastDFS%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8.html">2.42. Nginx整合FastDFS实现文件服务器</a></li>
<li class="toctree-l3"><a class="reference internal" href="45.ubuntu20.04-desktop-vmware-workstation.html">2.43. ubuntu20.04-desktop-vmware-workstation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../03.%E7%8E%A9%E8%BD%ACshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/index.html">3. 玩转shell脚本编程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04.%E7%8E%A9%E8%BD%AC%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88mysql%E3%80%81Redis%EF%BC%89/index.html">4. 玩转数据库(mysql、Redis)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05.Nginx%E5%AD%A6%E4%B9%A0/index.html">5. Nginx学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06.LAMP%E3%80%81LNMP%E5%AD%A6%E4%B9%A0/index.html">6. LNMP、LAMP学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07.Zabbix%E7%9B%91%E6%8E%A7%E4%BC%81%E4%B8%9A%E5%AE%9E%E6%88%98/index.html">7. Zabbix监控企业实战</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08.Linux%E6%9E%84%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/index.html">8. 构建Linux高可用架构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09.Zabbix3.0%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/index.html">9. Zabbix3.0入门到精通</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10.%E5%BF%AB%E9%80%9F%E9%98%85%E8%AF%BBLinux%E5%85%A5%E9%97%A8-%E9%98%BF%E9%93%ADLinux/index.html">10. 快速阅读Linux入门-阿铭Linux</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Mysql/index.html">Mysql王者之路</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other/index.html">Other</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Network_route_switch/index.html">Network_route_switch</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">小健_Linux-shell-Devops_Blog</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Linux</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">2. </span>Linux服务器架设</a> &raquo;</li>
      <li><span class="section-number">2.7. </span>使用iSCSI服务部署网络存储</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Linux/02.Linux服务器架设/6.使用iSCSI服务部署网络存储.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#iscsi" id="id1">使用iSCSI服务部署网络存储</a></p>
<ul>
<li><p><a class="reference internal" href="#raid" id="id2">创建RAID磁盘阵列</a></p></li>
<li><p><a class="reference internal" href="#iscsi-target-initiator" id="id3">iSCSI技术在工作形式上分为服务端（target）与客户端（initiator）。</a></p>
<ul>
<li><p><a class="reference internal" href="#windows" id="id4">配置Windows客户端</a></p></li>
<li><p><a class="reference internal" href="#linux" id="id5">配置Linux客户端</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="iscsi">
<h1><a class="toc-backref" href="#id1"><span class="section-number">2.7. </span>使用iSCSI服务部署网络存储</a><a class="headerlink" href="#iscsi" title="Permalink to this headline">¶</a></h1>
<p>硬盘接口类型主要有IDE、SCSI和SATA</p>
<ul class="simple">
<li><p>IDE是一种成熟稳定、价格便宜的并行传输接口。</p></li>
<li><p>SATA是一种传输速度更快、数据校验更完整的串行传输接口。</p></li>
<li><p>SCSI是一种用于计算机和硬盘、光驱等设备之间系统级接口的通用标准，具有系统资源占用率低、转速高、传输速度快等优点。</p></li>
</ul>
<section id="raid">
<h2><a class="toc-backref" href="#id2"><span class="section-number">2.7.1. </span>创建RAID磁盘阵列</a><a class="headerlink" href="#raid" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>添加4块新硬盘，用于创建RAID 5磁盘阵列和备份盘
</pre></div>
</div>
</section>
<section id="iscsi-target-initiator">
<h2><a class="toc-backref" href="#id3"><span class="section-number">2.7.2. </span>iSCSI技术在工作形式上分为服务端（target）与客户端（initiator）。</a><a class="headerlink" href="#iscsi-target-initiator" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>iSCSI服务端即用于存放硬盘存储资源的服务器，它作为前面创建的RAID磁盘阵列的存储端，
能够为用户提供可用的存储资源。iSCSI客户端则是用户使用的软件，用于访问远程服务端的存储资源。


[root@localhost ~]# mdadm -Cv /dev/md0 -n 3 -l 5 -x 1 /dev/sdb /dev/sdc /dev/sdd /dev/sde

[root@localhost ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE  MOUNTPOINT
sda               8:0    0   40G  0 disk
├─sda1            8:1    0  600M  0 part  /boot
└─sda2            8:2    0 39.4G  0 part
  ├─centos-root 253:0    0 37.4G  0 lvm   /
  └─centos-swap 253:1    0    2G  0 lvm   [SWAP]
sdb               8:16   0   20G  0 disk
└─md0             9:0    0   40G  0 raid5
sdc               8:32   0   20G  0 disk
└─md0             9:0    0   40G  0 raid5
sdd               8:48   0   20G  0 disk
└─md0             9:0    0   40G  0 raid5
sde               8:64   0   20G  0 disk
└─md0             9:0    0   40G  0 raid5
sr0              11:0    1 1024M  0 rom

[root@localhost ~]# mdadm -D /dev/md0
/dev/md0:
           Version : 1.2
     Creation Time : Mon Feb 11 19:11:50 2019
        Raid Level : raid5
        Array Size : 41908224 (39.97 GiB 42.91 GB)
     Used Dev Size : 20954112 (19.98 GiB 21.46 GB)
      Raid Devices : 3
     Total Devices : 4
       Persistence : Superblock is persistent

       Update Time : Mon Feb 11 19:12:56 2019
             State : clean
    Active Devices : 3
   Working Devices : 4
    Failed Devices : 0
     Spare Devices : 1

            Layout : left-symmetric
        Chunk Size : 512K

Consistency Policy : resync

              Name : localhost.localdomain:0  (local to host localhost.localdomain)
              UUID : b4b2db91:e75feb5b:a4a007ec:128f0def
            Events : 18

    Number   Major   Minor   RaidDevice State
       0       8       16        0      active sync   /dev/sdb
       1       8       32        1      active sync   /dev/sdc
       4       8       48        2      active sync   /dev/sdd

       3       8       64        -      spare   /dev/sde
</pre></div>
</div>
<p>第1步：配置好Yum软件仓库后安装iSCSI服务端程序以及配置命令工具</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>yum -y install targetd targetcli

安装完成后启动iSCSI的服务端程序targetd，然后把这个服务程序加入到开机启动项中，以便下次在服务器重启后依然能够为用户提供iSCSI共享存储资源服务：
[root@localhost ~]# systemctl start targetd
[root@localhost ~]# systemctl enable targetd
</pre></div>
</div>
<div class="line-block">
<div class="line">​</div>
<div class="line">第2步：配置iSCSI服务端共享资源。</div>
</div>
<p>targetcli是用于管理iSCSI服务端存储资源的专用配置命令，
它能够提供类似于fdisk命令的交互式配置功能，将iSCSI共享资源的配置内容抽象成“目录”的形式，
我们只需将各类配置信息填入到相应的“目录”中即可。这里的难点主要在于认识每个“参数目录”的作用。
当把配置参数正确地填写到“目录”中后，iSCSI服务端也可以提供共享资源服务了。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#/backstores/block是iSCSI服务端配置共享设备的位置</span>


<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2zeco591qzg5mo135djsZ</span> <span class="o">~</span><span class="p">]</span><span class="c1"># targetcli</span>
<span class="n">targetcli</span> <span class="n">shell</span> <span class="n">version</span> <span class="mf">2.1</span><span class="o">.</span><span class="n">fb46</span>
<span class="n">Copyright</span> <span class="mi">2011</span><span class="o">-</span><span class="mi">2013</span> <span class="n">by</span> <span class="n">Datera</span><span class="p">,</span> <span class="n">Inc</span> <span class="ow">and</span> <span class="n">others</span><span class="o">.</span>
<span class="n">For</span> <span class="n">help</span> <span class="n">on</span> <span class="n">commands</span><span class="p">,</span> <span class="nb">type</span> <span class="s1">&#39;help&#39;</span><span class="o">.</span>

<span class="o">/</span><span class="n">backstores</span><span class="o">/</span><span class="n">block</span><span class="o">&gt;</span> <span class="n">ls</span>
<span class="n">o</span><span class="o">-</span> <span class="n">block</span> <span class="o">......................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
<span class="o">/</span><span class="n">backstores</span><span class="o">/</span><span class="n">block</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="o">/</span>
<span class="o">/&gt;</span> <span class="n">ls</span>
<span class="n">o</span><span class="o">-</span> <span class="o">/</span> <span class="o">.........................................................................................................................</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">backstores</span> <span class="o">..............................................................................................................</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">block</span> <span class="o">..................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">fileio</span> <span class="o">.................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">pscsi</span> <span class="o">..................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">ramdisk</span> <span class="o">................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">iscsi</span> <span class="o">............................................................................................................</span> <span class="p">[</span><span class="n">Targets</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">loopback</span> <span class="o">.........................................................................................................</span> <span class="p">[</span><span class="n">Targets</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
<span class="o">/&gt;</span> <span class="n">cd</span> <span class="n">backstores</span><span class="o">/</span>
<span class="o">/</span><span class="n">backstores</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="n">block</span>

<span class="c1">#创建磁盘</span>
<span class="o">/</span><span class="n">backstores</span><span class="o">/</span><span class="n">block</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">disk0</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdb</span>
<span class="n">Created</span> <span class="n">block</span> <span class="n">storage</span> <span class="nb">object</span> <span class="n">disk0</span> <span class="n">using</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdb</span><span class="o">.</span>
<span class="o">/</span><span class="n">backstores</span><span class="o">/</span><span class="n">block</span><span class="o">&gt;</span>


<span class="o">/</span><span class="n">backstores</span><span class="o">/</span><span class="n">block</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="o">/</span>
<span class="o">/&gt;</span> <span class="n">ls</span>
<span class="n">o</span><span class="o">-</span> <span class="o">/</span> <span class="o">.........................................................................................................................</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">backstores</span> <span class="o">..............................................................................................................</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">block</span> <span class="o">..................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">disk0</span> <span class="o">.........................................................................</span> <span class="p">[</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdb</span> <span class="p">(</span><span class="mf">30.0</span><span class="n">GiB</span><span class="p">)</span> <span class="n">write</span><span class="o">-</span><span class="n">thru</span> <span class="n">deactivated</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span>   <span class="n">o</span><span class="o">-</span> <span class="n">alua</span> <span class="o">...................................................................................................</span> <span class="p">[</span><span class="n">ALUA</span> <span class="n">Groups</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span>     <span class="n">o</span><span class="o">-</span> <span class="n">default_tg_pt_gp</span> <span class="o">.......................................................................</span> <span class="p">[</span><span class="n">ALUA</span> <span class="n">state</span><span class="p">:</span> <span class="n">Active</span><span class="o">/</span><span class="n">optimized</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">fileio</span> <span class="o">.................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">pscsi</span> <span class="o">..................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">ramdisk</span> <span class="o">................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">iscsi</span> <span class="o">............................................................................................................</span> <span class="p">[</span><span class="n">Targets</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">loopback</span> <span class="o">.........................................................................................................</span> <span class="p">[</span><span class="n">Targets</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
<span class="o">/&gt;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">​</div>
<div class="line">第3步：创建iSCSI target名称及配置共享资源。</div>
</div>
<p>iSCSI
target名称是由系统自动生成的，这是一串用于描述共享资源的唯一字符串。
稍后用户在扫描iSCSI服务端时即可看到这个字符串，因此我们不需要记住它。
系统在生成这个target名称后，还会在/iscsi参数目录中创建一个与其字符串同名的新“目录”用来存放共享资源。
我们需要把前面加入到iSCSI共享资源池中的硬盘设备添加到这个新目录中，这样用户在登录iSCSI服务端后，
即可默认使用这硬盘设备提供的共享存储资源了。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/&gt;</span> <span class="n">cd</span> <span class="n">iscsi</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">&gt;</span> <span class="n">create</span>
<span class="n">Created</span> <span class="n">target</span> <span class="n">iqn</span><span class="mf">.2003</span><span class="o">-</span><span class="mf">01.</span><span class="n">org</span><span class="o">.</span><span class="n">linux</span><span class="o">-</span><span class="n">iscsi</span><span class="o">.</span><span class="n">iz2zeco591qzg5mo135djsz</span><span class="o">.</span><span class="n">x8664</span><span class="p">:</span><span class="n">sn</span><span class="mf">.9</span><span class="n">d355b25c9be</span><span class="o">.</span>
<span class="n">Created</span> <span class="n">TPG</span> <span class="mf">1.</span>
<span class="n">Global</span> <span class="n">pref</span> <span class="n">auto_add_default_portal</span><span class="o">=</span><span class="n">true</span>
<span class="n">Created</span> <span class="n">default</span> <span class="n">portal</span> <span class="n">listening</span> <span class="n">on</span> <span class="nb">all</span> <span class="n">IPs</span> <span class="p">(</span><span class="mf">0.0.0.0</span><span class="p">),</span> <span class="n">port</span> <span class="mf">3260.</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="n">iqn</span><span class="mf">.2003</span><span class="o">-</span><span class="mf">01.</span><span class="n">org</span><span class="o">.</span><span class="n">linux</span><span class="o">-</span><span class="n">iscsi</span><span class="o">.</span><span class="n">iz2zeco591qzg5mo135djsz</span><span class="o">.</span><span class="n">x8664</span><span class="p">:</span><span class="n">sn</span><span class="mf">.9</span><span class="n">d355b25c9be</span><span class="o">.</span>
<span class="n">No</span> <span class="n">such</span> <span class="n">path</span> <span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.2003</span><span class="o">-</span><span class="mf">01.</span><span class="n">org</span><span class="o">.</span><span class="n">linux</span><span class="o">-</span><span class="n">iscsi</span><span class="o">.</span><span class="n">iz2zeco591qzg5mo135djsz</span><span class="o">.</span><span class="n">x8664</span><span class="p">:</span><span class="n">sn</span><span class="mf">.9</span><span class="n">d355b25c9be</span><span class="o">.</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="n">iqn</span><span class="mf">.2003</span><span class="o">-</span><span class="mf">01.</span><span class="n">org</span><span class="o">.</span><span class="n">linux</span><span class="o">-</span><span class="n">iscsi</span><span class="o">.</span><span class="n">iz2zeco591qzg5mo135djsz</span><span class="o">.</span><span class="n">x8664</span><span class="p">:</span><span class="n">sn</span><span class="mf">.9</span><span class="n">d355b25c9be</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">...</span><span class="mf">.9</span><span class="n">d355b25c9be</span><span class="o">&gt;</span> <span class="n">ls</span>
<span class="n">o</span><span class="o">-</span> <span class="n">iqn</span><span class="mf">.2003</span><span class="o">-</span><span class="mf">01.</span><span class="n">org</span><span class="o">.</span><span class="n">linux</span><span class="o">-</span><span class="n">iscsi</span><span class="o">.</span><span class="n">iz2zeco591qzg5mo135djsz</span><span class="o">.</span><span class="n">x8664</span><span class="p">:</span><span class="n">sn</span><span class="mf">.9</span><span class="n">d355b25c9be</span> <span class="o">.............................................</span> <span class="p">[</span><span class="n">TPGs</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">tpg1</span> <span class="o">...................................................................................................</span> <span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="n">gen</span><span class="o">-</span><span class="n">acls</span><span class="p">,</span> <span class="n">no</span><span class="o">-</span><span class="n">auth</span><span class="p">]</span>
    <span class="n">o</span><span class="o">-</span> <span class="n">acls</span> <span class="o">..............................................................................................................</span> <span class="p">[</span><span class="n">ACLs</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">o</span><span class="o">-</span> <span class="n">luns</span> <span class="o">..............................................................................................................</span> <span class="p">[</span><span class="n">LUNs</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">o</span><span class="o">-</span> <span class="n">portals</span> <span class="o">........................................................................................................</span> <span class="p">[</span><span class="n">Portals</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
      <span class="n">o</span><span class="o">-</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">3260</span> <span class="o">.........................................................................................................</span> <span class="p">[</span><span class="n">OK</span><span class="p">]</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">...</span><span class="mf">.9</span><span class="n">d355b25c9be</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="n">tpg1</span><span class="o">/</span><span class="n">luns</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">..</span><span class="mf">.9</span><span class="n">be</span><span class="o">/</span><span class="n">tpg1</span><span class="o">/</span><span class="n">luns</span><span class="o">&gt;</span> <span class="n">create</span> <span class="o">/</span><span class="n">backstores</span><span class="o">/</span><span class="n">block</span><span class="o">/</span><span class="n">disk0</span>
<span class="n">Created</span> <span class="n">LUN</span> <span class="mf">0.</span>
</pre></div>
</div>
<p>第4步：设置访问控制列表（ACL）。</p>
<p>iSCSI协议是通过客户端名称进行验证的，也就是说，用户在访问存储共享资源时不需要输入密码，
只要iSCSI客户端的名称与服务端中设置的访问控制列表中某一名称条目一致即可，
因此需要在iSCSI服务端的配置文件中写入一串能够验证用户信息的名称。
acls参数目录用于存放能够访问iSCSI服务端共享存储资源的客户端名称。
建议在后面追加上类似于:client的参数，这样既能保证客户端的名称具有唯一性，又非常便于管理和阅读：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">..</span><span class="mf">.9</span><span class="n">be</span><span class="o">/</span><span class="n">tpg1</span><span class="o">/</span><span class="n">luns</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="o">../</span><span class="n">acls</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">..</span><span class="mf">.9</span><span class="n">be</span><span class="o">/</span><span class="n">tpg1</span><span class="o">/</span><span class="n">acls</span><span class="o">&gt;</span> <span class="n">create</span> <span class="n">iqn</span><span class="mf">.2003</span><span class="o">-</span><span class="mf">01.</span><span class="n">org</span><span class="o">.</span><span class="n">linux</span><span class="o">-</span><span class="n">iscsi</span><span class="o">.</span><span class="n">iz2zeco591qzg5mo135djsz</span>
<span class="n">Created</span> <span class="n">Node</span> <span class="n">ACL</span> <span class="k">for</span> <span class="n">iqn</span><span class="mf">.2003</span><span class="o">-</span><span class="mf">01.</span><span class="n">org</span><span class="o">.</span><span class="n">linux</span><span class="o">-</span><span class="n">iscsi</span><span class="o">.</span><span class="n">iz2zeco591qzg5mo135djsz</span>
<span class="n">Created</span> <span class="n">mapped</span> <span class="n">LUN</span> <span class="mf">0.</span>
</pre></div>
</div>
<p>第5步：设置iSCSI服务端的监听IP地址和端口号。</p>
<p>位于生产环境中的服务器上可能有多块网卡，
那么到底是由哪个网卡或IP地址对外提供共享存储资源呢？
这就需要我们在配置文件中手动定义iSCSI服务端的信息，即在portals参数目录中写上服务器的IP地址。
接下来将由系统自动开启服务器172.17.0.124s的3260端口将向外提供iSCSI共享存储资源服务：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">.../</span><span class="n">tpg1</span><span class="o">/</span><span class="n">portals</span><span class="o">&gt;</span> <span class="n">create</span> <span class="mf">172.17.0.124</span>
<span class="n">Using</span> <span class="n">default</span> <span class="n">IP</span> <span class="n">port</span> <span class="mi">3260</span>
<span class="n">Could</span> <span class="ow">not</span> <span class="n">create</span> <span class="n">NetworkPortal</span> <span class="ow">in</span> <span class="n">configFS</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">.../</span><span class="n">tpg1</span><span class="o">/</span><span class="n">portals</span><span class="o">&gt;</span> <span class="n">ls</span>
<span class="n">o</span><span class="o">-</span> <span class="n">portals</span> <span class="o">............................................................................................................</span> <span class="p">[</span><span class="n">Portals</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">3260</span> <span class="o">.............................................................................................................</span> <span class="p">[</span><span class="n">OK</span><span class="p">]</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">.../</span><span class="n">tpg1</span><span class="o">/</span><span class="n">portals</span><span class="o">&gt;</span> <span class="n">delete</span> <span class="mf">0.0.0.0</span> <span class="mi">3260</span>
<span class="n">Deleted</span> <span class="n">network</span> <span class="n">portal</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">3260</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">.../</span><span class="n">tpg1</span><span class="o">/</span><span class="n">portals</span><span class="o">&gt;</span> <span class="n">create</span> <span class="mf">172.17.0.124</span>
<span class="n">Using</span> <span class="n">default</span> <span class="n">IP</span> <span class="n">port</span> <span class="mi">3260</span>
<span class="n">Created</span> <span class="n">network</span> <span class="n">portal</span> <span class="mf">172.17.0.124</span><span class="p">:</span><span class="mf">3260.</span>
</pre></div>
</div>
<p>第6步：配置妥当后检查配置信息，重启iSCSI服务端程序并配置防火墙策略。</p>
<p>在参数文件配置妥当后，可以浏览刚刚配置的信息，确保与下面的信息基本一致。
在确认信息无误后输入exit命令来退出配置。注意，千万不要习惯性地按Ctrl +
C组合键结束进程， 这样不会保存配置文件，我们的工作也就白费了。
最后重启iSCSI服务端程序，再设置firewalld防火墙策略，使其放行3260/tcp端口号的流量。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">.../</span><span class="n">tpg1</span><span class="o">/</span><span class="n">portals</span><span class="o">&gt;</span> <span class="n">ls</span>
<span class="n">o</span><span class="o">-</span> <span class="n">portals</span> <span class="o">............................................................................................................</span> <span class="p">[</span><span class="n">Portals</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="mf">172.17.0.124</span><span class="p">:</span><span class="mi">3260</span> <span class="o">........................................................................................................</span> <span class="p">[</span><span class="n">OK</span><span class="p">]</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">.../</span><span class="n">tpg1</span><span class="o">/</span><span class="n">portals</span><span class="o">&gt;</span> <span class="n">ls</span> <span class="o">/</span>
<span class="n">o</span><span class="o">-</span> <span class="o">/</span> <span class="o">.........................................................................................................................</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">backstores</span> <span class="o">..............................................................................................................</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">block</span> <span class="o">..................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">disk0</span> <span class="o">...........................................................................</span> <span class="p">[</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdb</span> <span class="p">(</span><span class="mf">30.0</span><span class="n">GiB</span><span class="p">)</span> <span class="n">write</span><span class="o">-</span><span class="n">thru</span> <span class="n">activated</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span>   <span class="n">o</span><span class="o">-</span> <span class="n">alua</span> <span class="o">...................................................................................................</span> <span class="p">[</span><span class="n">ALUA</span> <span class="n">Groups</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span> <span class="o">|</span>     <span class="n">o</span><span class="o">-</span> <span class="n">default_tg_pt_gp</span> <span class="o">.......................................................................</span> <span class="p">[</span><span class="n">ALUA</span> <span class="n">state</span><span class="p">:</span> <span class="n">Active</span><span class="o">/</span><span class="n">optimized</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">fileio</span> <span class="o">.................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">pscsi</span> <span class="o">..................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">ramdisk</span> <span class="o">................................................................................................</span> <span class="p">[</span><span class="n">Storage</span> <span class="n">Objects</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">iscsi</span> <span class="o">............................................................................................................</span> <span class="p">[</span><span class="n">Targets</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">iqn</span><span class="mf">.2003</span><span class="o">-</span><span class="mf">01.</span><span class="n">org</span><span class="o">.</span><span class="n">linux</span><span class="o">-</span><span class="n">iscsi</span><span class="o">.</span><span class="n">iz2zeco591qzg5mo135djsz</span><span class="o">.</span><span class="n">x8664</span><span class="p">:</span><span class="n">sn</span><span class="mf">.9</span><span class="n">d355b25c9be</span> <span class="o">.........................................</span> <span class="p">[</span><span class="n">TPGs</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span>   <span class="n">o</span><span class="o">-</span> <span class="n">tpg1</span> <span class="o">...............................................................................................</span> <span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="n">gen</span><span class="o">-</span><span class="n">acls</span><span class="p">,</span> <span class="n">no</span><span class="o">-</span><span class="n">auth</span><span class="p">]</span>
  <span class="o">|</span>     <span class="n">o</span><span class="o">-</span> <span class="n">acls</span> <span class="o">..........................................................................................................</span> <span class="p">[</span><span class="n">ACLs</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span>     <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">iqn</span><span class="mf">.2003</span><span class="o">-</span><span class="mf">01.</span><span class="n">org</span><span class="o">.</span><span class="n">linux</span><span class="o">-</span><span class="n">iscsi</span><span class="o">.</span><span class="n">iz2zeco591qzg5mo135djsz</span> <span class="o">..................................................</span> <span class="p">[</span><span class="n">Mapped</span> <span class="n">LUNs</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span>     <span class="o">|</span>   <span class="n">o</span><span class="o">-</span> <span class="n">mapped_lun0</span> <span class="o">.................................................................................</span> <span class="p">[</span><span class="n">lun0</span> <span class="n">block</span><span class="o">/</span><span class="n">disk0</span> <span class="p">(</span><span class="n">rw</span><span class="p">)]</span>
  <span class="o">|</span>     <span class="n">o</span><span class="o">-</span> <span class="n">luns</span> <span class="o">..........................................................................................................</span> <span class="p">[</span><span class="n">LUNs</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span>     <span class="o">|</span> <span class="n">o</span><span class="o">-</span> <span class="n">lun0</span> <span class="o">......................................................................</span> <span class="p">[</span><span class="n">block</span><span class="o">/</span><span class="n">disk0</span> <span class="p">(</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vdb</span><span class="p">)</span> <span class="p">(</span><span class="n">default_tg_pt_gp</span><span class="p">)]</span>
  <span class="o">|</span>     <span class="n">o</span><span class="o">-</span> <span class="n">portals</span> <span class="o">....................................................................................................</span> <span class="p">[</span><span class="n">Portals</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
  <span class="o">|</span>       <span class="n">o</span><span class="o">-</span> <span class="mf">172.17.0.124</span><span class="p">:</span><span class="mi">3260</span> <span class="o">................................................................................................</span> <span class="p">[</span><span class="n">OK</span><span class="p">]</span>
  <span class="n">o</span><span class="o">-</span> <span class="n">loopback</span> <span class="o">.........................................................................................................</span> <span class="p">[</span><span class="n">Targets</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span>
<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">.../</span><span class="n">tpg1</span><span class="o">/</span><span class="n">portals</span><span class="o">&gt;</span>

<span class="o">/</span><span class="n">iscsi</span><span class="o">/</span><span class="n">iqn</span><span class="mf">.20</span><span class="o">.../</span><span class="n">tpg1</span><span class="o">/</span><span class="n">portals</span><span class="o">&gt;</span> <span class="n">exit</span>
<span class="n">Global</span> <span class="n">pref</span> <span class="n">auto_save_on_exit</span><span class="o">=</span><span class="n">true</span>
<span class="n">Last</span> <span class="mi">10</span> <span class="n">configs</span> <span class="n">saved</span> <span class="ow">in</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">backup</span><span class="o">/.</span>
<span class="n">Configuration</span> <span class="n">saved</span> <span class="n">to</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">saveconfig</span><span class="o">.</span><span class="n">json</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2zeco591qzg5mo135djsZ</span> <span class="o">~</span><span class="p">]</span><span class="c1"># systemctl restart targetd</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2zeco591qzg5mo135djsZ</span> <span class="o">~</span><span class="p">]</span><span class="c1"># firewall-cmd --permanent --add-port=3260/tcp</span>
<span class="n">FirewallD</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">running</span>
<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2zeco591qzg5mo135djsZ</span> <span class="o">~</span><span class="p">]</span><span class="c1"># firewall-cmd --reload</span>
<span class="n">FirewallD</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">running</span>
</pre></div>
</div>
<p>iSCSI服务端的配置至此全部完成。</p>
<section id="windows">
<h3><a class="toc-backref" href="#id4">配置Windows客户端</a><a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h3>
<p><img alt="image0" src="../../_images/iSCSI.PNG" /> <img alt="image1" src="../../_images/iSCSI2.PNG" /></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>由于在iSCSI服务端程序上设置了ACL，
使得只有客户端名称与ACL策略中的名称保持一致时才能使用远程存储资源，
因此需要在“配置”选项卡中单击“更改”按钮，
把iSCSI发起程序的名称修改为服务端ACL所定义的名称
</pre></div>
</div>
<p><img alt="image2" src="../../_images/iSCSI3.PNG" /></p>
<p><img alt="image3" src="../../_images/iSCSI5.PNG" /></p>
</section>
<section id="linux">
<h3><a class="toc-backref" href="#id5">配置Linux客户端</a><a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ iscsiadm -m discovery -t st -p <span class="m">192</span>.168.5.174
<span class="m">192</span>.168.5.174:3260,1 iqn.2020-06.supool.com:lun02
<span class="m">192</span>.168.5.173:3260,1 iqn.2020-06.supool.com:lun02
<span class="m">192</span>.168.5.175:3260,1 iqn.2020-06.supool.com:lun02


$ iscsiadm -m node -T iqn.2020-06.supool.com:lun02 -p <span class="m">192</span>.168.5.173:3260,1 --login

Logging <span class="k">in</span> to <span class="o">[</span>iface: default, target: iqn.2020-06.supool.com:lun02, portal: <span class="m">192</span>.168.5.173,3260<span class="o">]</span> <span class="o">(</span>multiple<span class="o">)</span>
Login to <span class="o">[</span>iface: default, target: iqn.2020-06.supool.com:lun02, portal: <span class="m">192</span>.168.5.173,3260<span class="o">]</span> successful.

$ lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      <span class="m">8</span>:0    <span class="m">0</span>   80G  <span class="m">0</span> disk
├─sda1   <span class="m">8</span>:1    <span class="m">0</span>    2G  <span class="m">0</span> part /boot
├─sda2   <span class="m">8</span>:2    <span class="m">0</span>    8G  <span class="m">0</span> part <span class="o">[</span>SWAP<span class="o">]</span>
└─sda3   <span class="m">8</span>:3    <span class="m">0</span>   70G  <span class="m">0</span> part /
sdb      <span class="m">8</span>:16   <span class="m">0</span>    1T  <span class="m">0</span> disk
sr0     <span class="m">11</span>:0    <span class="m">1</span> 1024M  <span class="m">0</span> rom


$ file /dev/sdb
/dev/sdb: block special

<span class="c1"># 查看到1TB数据我们不再进行分区，而是直接格式化并挂载使用。</span>
<span class="c1"># 格式化</span>
<span class="o">[</span>root@supool-10 vdbench_test<span class="o">]</span><span class="c1"># mkfs.xfs /dev/sdb</span>
meta-data<span class="o">=</span>/dev/sdb               <span class="nv">isize</span><span class="o">=</span><span class="m">512</span>    <span class="nv">agcount</span><span class="o">=</span><span class="m">4</span>, <span class="nv">agsize</span><span class="o">=</span><span class="m">67108864</span> <span class="nv">blks</span>
         <span class="o">=</span>                       <span class="nv">sectsz</span><span class="o">=</span><span class="m">4096</span>  <span class="nv">attr</span><span class="o">=</span><span class="m">2</span>, <span class="nv">projid32bit</span><span class="o">=</span><span class="nv">1</span>
         <span class="o">=</span>                       <span class="nv">crc</span><span class="o">=</span><span class="m">1</span>        <span class="nv">finobt</span><span class="o">=</span><span class="m">0</span>, <span class="nv">sparse</span><span class="o">=</span><span class="m">0</span>
<span class="nv">data</span>     <span class="o">=</span>                       <span class="nv">bsize</span><span class="o">=</span><span class="m">4096</span>   <span class="nv">blocks</span><span class="o">=</span><span class="m">268435456</span>, <span class="nv">imaxpct</span><span class="o">=</span><span class="nv">5</span>
         <span class="o">=</span>                       <span class="nv">sunit</span><span class="o">=</span><span class="m">0</span>      <span class="nv">swidth</span><span class="o">=</span><span class="m">0</span> blks
<span class="nv">naming</span>   <span class="o">=</span>version <span class="m">2</span>              <span class="nv">bsize</span><span class="o">=</span><span class="m">4096</span>   ascii-ci<span class="o">=</span><span class="m">0</span> <span class="nv">ftype</span><span class="o">=</span><span class="m">1</span>
<span class="nv">log</span>      <span class="o">=</span>internal log           <span class="nv">bsize</span><span class="o">=</span><span class="m">4096</span>   <span class="nv">blocks</span><span class="o">=</span><span class="m">131072</span>, <span class="nv">version</span><span class="o">=</span><span class="nv">2</span>
         <span class="o">=</span>                       <span class="nv">sectsz</span><span class="o">=</span><span class="m">4096</span>  <span class="nv">sunit</span><span class="o">=</span><span class="m">1</span> blks, lazy-count<span class="o">=</span><span class="m">1</span>
<span class="nv">realtime</span> <span class="o">=</span>none                   <span class="nv">extsz</span><span class="o">=</span><span class="m">4096</span>   <span class="nv">blocks</span><span class="o">=</span><span class="m">0</span>, <span class="nv">rtextents</span><span class="o">=</span><span class="m">0</span>
<span class="o">[</span>root@supool-10 vdbench_test<span class="o">]</span><span class="c1"># mkdir /iscsi</span>
<span class="o">[</span>root@supool-10 vdbench_test<span class="o">]</span><span class="c1"># mount /dev/sdb /iscsi</span>
<span class="o">[</span>root@supool-10 vdbench_test<span class="o">]</span><span class="c1"># df -h</span>
Filesystem                   Size  Used Avail Use% Mounted on
devtmpfs                     <span class="m">2</span>.0G     <span class="m">0</span>  <span class="m">2</span>.0G   <span class="m">0</span>% /dev
tmpfs                        <span class="m">2</span>.0G     <span class="m">0</span>  <span class="m">2</span>.0G   <span class="m">0</span>% /dev/shm
tmpfs                        <span class="m">2</span>.0G  <span class="m">9</span>.8M  <span class="m">2</span>.0G   <span class="m">1</span>% /run
tmpfs                        <span class="m">2</span>.0G     <span class="m">0</span>  <span class="m">2</span>.0G   <span class="m">0</span>% /sys/fs/cgroup
/dev/sda3                     70G   29G   42G  <span class="m">42</span>% /
/dev/sda1                    <span class="m">2</span>.0G  168M  <span class="m">1</span>.9G   <span class="m">9</span>% /boot
tmpfs                        396M   12K  396M   <span class="m">1</span>% /run/user/42
tmpfs                        396M     <span class="m">0</span>  396M   <span class="m">0</span>% /run/user/0
<span class="m">192</span>.168.5.173:/vol/supool_d   33T  148M   33T   <span class="m">1</span>% /mnt/nfs
/dev/sdb                     <span class="m">1</span>.0T   33M  <span class="m">1</span>.0T   <span class="m">1</span>% /iscsi

<span class="c1"># blkid 命令用于查看设备的名称、文件系统及 UUID</span>
$ blkid <span class="p">|</span> grep /dev/sdb
/dev/sdb: <span class="nv">UUID</span><span class="o">=</span><span class="s2">&quot;670faf91-f594-4655-91cf-c9dcea95b4d8&quot;</span> <span class="nv">TYPE</span><span class="o">=</span><span class="s2">&quot;xfs&quot;</span>

<span class="c1"># 设置开机自动挂载</span>
vim /etc/fstab
<span class="c1">#</span>
<span class="c1"># /etc/fstab</span>
<span class="c1"># Created by anaconda on Wed May 4 19:26:23 2017</span>
<span class="c1">#</span>
<span class="c1"># Accessible filesystems, by reference, are maintained under &#39;/dev/disk&#39;</span>
<span class="c1"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span>
<span class="c1">#</span>
/dev/mapper/rhel-root / xfs defaults <span class="m">1</span> <span class="m">1</span>
<span class="nv">UUID</span><span class="o">=</span>812b1f7c-8b5b-43da-8c06-b9999e0fe48b /boot xfs defaults <span class="m">1</span> <span class="m">2</span>
/dev/mapper /rhel-swap swap swap defaults <span class="m">0</span> <span class="m">0</span>
/dev/cdrom /media/cdrom iso9660 defaults <span class="m">0</span> <span class="m">0</span>
<span class="nv">UUID</span><span class="o">=</span>670faf91-f594-4655-91cf-c9dcea95b4d8 /iscsi xfs defaults,_ _netdev <span class="m">0</span> <span class="m">0</span>
</pre></div>
</div>
<p>如果我们不再需要使用 iSCSI 共享设备资源了，可以用 iscsiadm 命令的-u
参数将其设备卸载：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ iscsiadm -m node -T iqn.2003-01.org.linux-iscsi.linuxprobe.x8664:sn.d497c356ad80 -u
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="5.Apache%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA.html" class="btn btn-neutral float-left" title="2.6. Apache服务源码搭建" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="7.%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95Linux%E7%B3%BB%E7%BB%9F.html" class="btn btn-neutral float-right" title="2.8. 远程登录Linux系统" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>