<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>6.3. LAMP+Radis企业实战 &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6.4. MySQL主从同步、读写分离解决方案" href="04.LAMP%E4%BC%81%E4%B8%9A%E6%9E%B6%E6%9E%84%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.html" />
    <link rel="prev" title="6.2. LAMP企业架构实战" href="02.LAMP%E4%BC%81%E4%B8%9A%E6%9E%B6%E6%9E%84%E5%AE%9E%E6%88%98.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> 小健_Linux-shell-Devops_Blog
            <img src="../../_static/devops_photo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../DevOps/index.html">DevOps和自动化运维实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Github/index.html">Github入门到实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Jenkins/index.html">Jenkins持续化集成</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../KVM/index.html">KVM实践</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01.%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%92%8C%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/index.html">1. 命令行和操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02.Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9E%B6%E8%AE%BE/index.html">2. Linux服务器架设</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03.%E7%8E%A9%E8%BD%ACshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/index.html">3. 玩转shell脚本编程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04.%E7%8E%A9%E8%BD%AC%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88mysql%E3%80%81Redis%EF%BC%89/index.html">4. 玩转数据库(mysql、Redis)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05.Nginx%E5%AD%A6%E4%B9%A0/index.html">5. Nginx学习</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">6. LNMP、LAMP学习</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01.LAMP%E9%83%A8%E7%BD%B2.html">6.1. LAMP+WordPress环境</a></li>
<li class="toctree-l3"><a class="reference internal" href="02.LAMP%E4%BC%81%E4%B8%9A%E6%9E%B6%E6%9E%84%E5%AE%9E%E6%88%98.html">6.2. LAMP企业架构实战</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">6.3. LAMP+Radis企业实战</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">6.3.1. LAMP+Radis工作机制</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lamp-redis">6.3.2. LAMP+Redis操作案例</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="04.LAMP%E4%BC%81%E4%B8%9A%E6%9E%B6%E6%9E%84%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.html">6.4. MySQL主从同步、读写分离解决方案</a></li>
<li class="toctree-l3"><a class="reference internal" href="05.%E4%B8%80%E9%94%AE%E5%BF%AB%E9%80%9Flnmp.html">6.5. 一键快速lnmp</a></li>
<li class="toctree-l3"><a class="reference internal" href="06.%E5%AE%9D%E5%A1%94%E5%AE%89%E8%A3%85CRM%E7%B3%BB%E5%88%97%E8%BD%AF%E4%BB%B6.html">6.6. 宝塔安装CRM系列软件</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../07.Zabbix%E7%9B%91%E6%8E%A7%E4%BC%81%E4%B8%9A%E5%AE%9E%E6%88%98/index.html">7. Zabbix监控企业实战</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08.Linux%E6%9E%84%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/index.html">8. 构建Linux高可用架构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09.Zabbix3.0%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/index.html">9. Zabbix3.0入门到精通</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10.%E5%BF%AB%E9%80%9F%E9%98%85%E8%AF%BBLinux%E5%85%A5%E9%97%A8-%E9%98%BF%E9%93%ADLinux/index.html">10. 快速阅读Linux入门-阿铭Linux</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Mysql/index.html">Mysql王者之路</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other/index.html">Other</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Network_route_switch/index.html">Network_route_switch</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">小健_Linux-shell-Devops_Blog</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Linux</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">6. </span>LNMP、LAMP学习</a> &raquo;</li>
      <li><span class="section-number">6.3. </span>LAMP+Radis企业实战</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Linux/06.LAMP、LNMP学习/03.LAMP+Redis企业实战.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#lamp-radis" id="id2">LAMP+Radis企业实战</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id3">LAMP+Radis工作机制</a></p></li>
<li><p><a class="reference internal" href="#lamp-redis" id="id4">LAMP+Redis操作案例</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="lamp-radis">
<h1><a class="toc-backref" href="#id2"><span class="section-number">6.3. </span>LAMP+Radis企业实战</a><a class="headerlink" href="#lamp-radis" title="Permalink to this headline">¶</a></h1>
<p>LAMP 在企业生产环境中，除了将MySQL 单独部署在其他服务器， 由于MySQL
数据库压力会很大，还会使用MySQL 主从复制及读写分离架构， 同时会对PHP
网站进行调优。 PHP 的优化手段包括： PHP 代码本身优化、PHP
配置文件优化、为PHP 添加缓存模块、将PHP 网站数据存人缓存等。</p>
<section id="id1">
<h2><a class="toc-backref" href="#id3"><span class="section-number">6.3.1. </span>LAMP+Radis工作机制</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>LAMP+Radis工作机制：用户通过浏览器访问LAMP网站，并以用户名和密码登录到网站，默认Redis缓存中没有该用户名和密码对应列表，PHP程序会读取MySQL数据库中的用户名和密码，
然后将用户名和密码缓存至Redis中，下次用户通过浏览器再次使用同样的用户名和密码登录网站，PHP无需从数据库中读取该用户和密码信息，而是直接优先从Redis缓存中读取并返回，从而减轻MySQL数据库的压力。

Redis除了可以缓存用户名、密码，还可以缓存PHP论坛各种数据，例如用户帖子、用户动态等。

要实现将LAMP PHP网站相关数据存入Redis，需要一台Redis服务器、PHP-Redis连接驱动、PHP代码配置等。
</pre></div>
</div>
</section>
<section id="lamp-redis">
<h2><a class="toc-backref" href="#id4"><span class="section-number">6.3.2. </span>LAMP+Redis操作案例</a><a class="headerlink" href="#lamp-redis" title="Permalink to this headline">¶</a></h2>
<p><img alt="image0" src="../../_images/LAMP+Redis2.png" /></p>
<p>(1)环境说明：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>* LAMP服务器：47.105.219.73
* Redis主库：47.105.218.36
* Redis从库：120.27.1.112  #暂不配置，主从架构在高可用章节有演示
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Redis主库上安装部署Redis服务，代码如下：</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>wget http://download.redis.io/releases/redis-2.8.13.tar.gz
tar zxvf redis-2.8.13.tar.gz
cd redis-2.8.13
make PREFIX=/usr/local/redis install
cp redis.conf /usr/local/redis/

#将/usr/local/redis/bin目录加入至环境变量配置文件/etc/profile末尾
# 然后source /etc/profile让环境变量生效，代码如下：
export PATH=/usr/local/redis/bin/:$PATH &gt;&gt; /etc/profile
source /etc/profile

#nohup后台启动及停止Redis服务命令，代码如下
#启动
nohup /usr/local/redis/bin/redis-server /usr/local/redis/redis.conf &amp;

#停止
[root@iZm5e5d49vjfft0t3en4l9Z redis-2.8.13]# /usr/local/redis/bin/redis-cli -p 6379 shutdown
[1]+  Done                    nohup /usr/local/redis/bin/redis-server /usr/local/redis/redis.conf

/usr/local/redis/bin/redis-cli  #登录redis客户端

vim /usr/local/redis/redis.conf   修改配置文件
bind 0.0.0.0     #在61行 原本是127.0.0.1 改为0.0.0.0 这样才可以让lamp调用redis
daemonize yes    #在128行 找到这一行 原本为no 改为yes，yes表示以守护进程的方式启动

编辑/etc/sysctl.conf 添加vm.overcommit_memory=1，然后sysctl -p 使配置文件生效
#这个内核参数作用：表示内核允许分配所有的物理内存，而不管当前的内存状态如何。
/etc/init.d/redis start  #启动redis
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>在LAMP服务器上安装PHP-Redis 连接驱动。要确保PHP 能够连接Redis
缓存服务器， 需添加PHP-Redis 扩展程序， 也即是添加 PHP
安装ext扩展模块， 添加方法如下：</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd /usr/src/
wget -c -P /src https://github.com/phpredis/phpredis/archive/3.1.2.tar.gz &amp;&amp; tar zxvf 3.1.2.tar.gz -C /src
cd  /src/phpredis-3.1.2
/usr/local/php/bin/phpize       #which phpize 或直接执行phpize
./configure --with-php-config=/usr/local/php/bin/php-config --enable-redis
make
make install
Installing shared extensions:     /usr/lib64/php/modules/


修改vim /usr/local/php5/lib/php.ini配置文件，添加redis.so模块，代码如下：
extension_dir = &quot;/usr/lib64/php/modules/&quot;
extension=redis.so

重启Apache服务，写入phpinfo测试页面，通过浏览器访问，检查到存在Redis模块即可
</pre></div>
</div>
<p><img alt="image1" src="../../_images/redis_so_info.png" /></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@iZm5e5d49vjffsyzzdx9x7Z</span> <span class="n">html</span><span class="p">]</span><span class="c1"># php -m |  grep redis</span>
<span class="n">redis</span>

<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2zef16b22gl2ycc4pkblZ</span> <span class="n">webdata</span><span class="p">]</span><span class="c1"># ./configure  --with-php-config=/etc/php  --enable-redis</span>

<span class="p">[</span><span class="n">root</span><span class="nd">@iZ2zef16b22gl2ycc4pkblZ</span> <span class="n">webdata</span><span class="p">]</span><span class="c1"># /etc/init.d/php-fpm restart</span>


<span class="n">修改Discuz</span> <span class="n">PHP网站发布</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">apache</span><span class="o">/</span><span class="n">htdocs目录全局配置文件config_global</span><span class="o">.</span><span class="n">php</span>
</pre></div>
</div>
<p><img alt="image2" src="../../_images/redis_config.png" /></p>
<ol class="arabic simple" start="4">
<li><p>LAMP+Redis缓存测试 <img alt="image3" src="../../_images/redis_test01.png" /> <img alt="image4" src="../../_images/redis_mysql01.png" /></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    MariaDB [(none)]&gt; use discuz;
    Reading table information for completion of table and column names
    You can turn off this feature to get a quicker startup with -A


    MariaDB [discuz]&gt; select uid,email,username,password from pre_common_member;
    +-----+-------------------+----------+----------------------------------+
    | uid | email             | username | password                         |
    +-----+-------------------+----------+----------------------------------+
    |   1 | admin@admin.com   | admin    | 97e6193638198911ab0be475cf27e917 |
    |   2 | 1879324764@qq.com | aaa      | c946e586846eb6a17a487348f2bb0ada |
    |   3 | 962057147@qq.com  | hujianli | ad412759785df40ce5aa8e56850d34e4 |
    +-----+-------------------+----------+----------------------------------+

将aaa用户从mysql数据库中删除，然后验证是否可以从redis缓存记录中登录

    MariaDB [discuz]&gt;  delete from pre_common_member where uid=2;
    Query OK, 1 row affected (0.00 sec)

    MariaDB [discuz]&gt; select uid,email,username,password from pre_common_member;
    +-----+------------------+----------+----------------------------------+
    | uid | email            | username | password                         |
    +-----+------------------+----------+----------------------------------+
    |   1 | admin@admin.com  | admin    | 97e6193638198911ab0be475cf27e917 |
    |   3 | 962057147@qq.com | hujianli | ad412759785df40ce5aa8e56850d34e4 |
    +-----+------------------+----------+----------------------------------+
</pre></div>
</div>
<p><img alt="image5" src="../../_images/redis_mysql0002.png" /></p>
<p>Redis缓存生效！</p>
<p>参考文献</p>
<p><a class="reference external" href="https://www.cnblogs.com/hystj/articles/8849234.html">https://www.cnblogs.com/hystj/articles/8849234.html</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="02.LAMP%E4%BC%81%E4%B8%9A%E6%9E%B6%E6%9E%84%E5%AE%9E%E6%88%98.html" class="btn btn-neutral float-left" title="6.2. LAMP企业架构实战" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="04.LAMP%E4%BC%81%E4%B8%9A%E6%9E%B6%E6%9E%84%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.html" class="btn btn-neutral float-right" title="6.4. MySQL主从同步、读写分离解决方案" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>