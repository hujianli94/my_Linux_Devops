<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>6.2. LAMP企业架构实战 &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6.3. LAMP+Radis企业实战" href="03.LAMP%2BRedis%E4%BC%81%E4%B8%9A%E5%AE%9E%E6%88%98.html" />
    <link rel="prev" title="6.1. LAMP+WordPress环境" href="01.LAMP%E9%83%A8%E7%BD%B2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> 小健_Linux-shell-Devops_Blog
            <img src="../../_static/devops_photo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../DevOps/index.html">DevOps和自动化运维实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Github/index.html">Github入门到实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Jenkins/index.html">Jenkins持续化集成</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../KVM/index.html">KVM实践</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01.%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%92%8C%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/index.html">1. 命令行和操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02.Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9E%B6%E8%AE%BE/index.html">2. Linux服务器架设</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03.%E7%8E%A9%E8%BD%ACshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B/index.html">3. 玩转shell脚本编程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04.%E7%8E%A9%E8%BD%AC%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88mysql%E3%80%81Redis%EF%BC%89/index.html">4. 玩转数据库(mysql、Redis)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05.Nginx%E5%AD%A6%E4%B9%A0/index.html">5. Nginx学习</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">6. LNMP、LAMP学习</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01.LAMP%E9%83%A8%E7%BD%B2.html">6.1. LAMP+WordPress环境</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">6.2. LAMP企业架构实战</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">6.2.1. LAMP企业安装配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">6.2.2. LAMP企业架构拓展实战</a></li>
<li class="toctree-l4"><a class="reference internal" href="#centos7yummysql5-7-22">6.2.3. Centos7使用yum源安装mysql5.7.22</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">6.2.4. 忘记密码</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="03.LAMP%2BRedis%E4%BC%81%E4%B8%9A%E5%AE%9E%E6%88%98.html">6.3. LAMP+Radis企业实战</a></li>
<li class="toctree-l3"><a class="reference internal" href="04.LAMP%E4%BC%81%E4%B8%9A%E6%9E%B6%E6%9E%84%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB.html">6.4. MySQL主从同步、读写分离解决方案</a></li>
<li class="toctree-l3"><a class="reference internal" href="05.%E4%B8%80%E9%94%AE%E5%BF%AB%E9%80%9Flnmp.html">6.5. 一键快速lnmp</a></li>
<li class="toctree-l3"><a class="reference internal" href="06.%E5%AE%9D%E5%A1%94%E5%AE%89%E8%A3%85CRM%E7%B3%BB%E5%88%97%E8%BD%AF%E4%BB%B6.html">6.6. 宝塔安装CRM系列软件</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../07.Zabbix%E7%9B%91%E6%8E%A7%E4%BC%81%E4%B8%9A%E5%AE%9E%E6%88%98/index.html">7. Zabbix监控企业实战</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08.Linux%E6%9E%84%E5%BB%BA%E9%AB%98%E5%8F%AF%E7%94%A8%E6%9E%B6%E6%9E%84/index.html">8. 构建Linux高可用架构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09.Zabbix3.0%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/index.html">9. Zabbix3.0入门到精通</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10.%E5%BF%AB%E9%80%9F%E9%98%85%E8%AF%BBLinux%E5%85%A5%E9%97%A8-%E9%98%BF%E9%93%ADLinux/index.html">10. 快速阅读Linux入门-阿铭Linux</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Mysql/index.html">Mysql王者之路</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other/index.html">Other</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Network_route_switch/index.html">Network_route_switch</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">小健_Linux-shell-Devops_Blog</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Linux</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">6. </span>LNMP、LAMP学习</a> &raquo;</li>
      <li><span class="section-number">6.2. </span>LAMP企业架构实战</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Linux/06.LAMP、LNMP学习/02.LAMP企业架构实战.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#lamp" id="id5">LAMP企业架构实战</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id6">LAMP企业安装配置</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id7">构建LAMP架构有两种方法：</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id3" id="id8">LAMP企业架构拓展实战</a></p></li>
<li><p><a class="reference internal" href="#centos7yummysql5-7-22" id="id9">Centos7使用yum源安装mysql5.7.22</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id10">忘记密码</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="lamp">
<h1><a class="toc-backref" href="#id5"><span class="section-number">6.2. </span>LAMP企业架构实战</a><a class="headerlink" href="#lamp" title="Permalink to this headline">¶</a></h1>
<section id="id1">
<h2><a class="toc-backref" href="#id6"><span class="section-number">6.2.1. </span>LAMP企业安装配置</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<section id="id2">
<h3><a class="toc-backref" href="#id7">构建LAMP架构有两种方法：</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">①</span> <span class="pre">使用YUM在线安装</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">②</span> <span class="pre">基于LAMP源码编译安装</span></code></p>
<section id="yum">
<h4>YUM现在安装方法如下：<a class="headerlink" href="#yum" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>yum -y install httpd mariadb-server php-mysql php

程序包版本：
httpd：2.4.6
mariadb-server：5.5.56
php-mysql（PHP连接MySQL时需要用到的驱动）：5.4.16
php：5.4.16
</pre></div>
</div>
<p>​ CentOS 7.4已经不再提供mysql-server的程序包</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>httpd配置文件：
   1、主配置文件：/etc/httpd/conf/httpd.conf
   2、辅助配置文件：/etc/httpd/conf.d/*.conf
   3、模块配置文件：/etc/httpd/conf.modules.d/*.conf
   mariadb配置文件：/etc/my.cnf
   php配置文件：/etc/php.ini
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>httpd与php组合时需要用到的配置文件：/etc/httpd/conf.d/php.conf
httpd与php组合时需要用到的模块文件：/usr/lib64/httpd/modules/libphp5.so

[root@iZ2zeanknh4l64n4rnlnr6Z html]# httpd -M | grep mpm

s message mpm_prefork_module (shared)

[root@iZ2zeanknh4l64n4rnlnr6Z html]# httpd -M | grep php
s message php5_module (shared)
</pre></div>
</div>
<p>二、测试LAMP环境：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#systemctl start httpd.service

systemctl restart httpd.service

# systemctl start mariadb.service

# mysql_secure_installation     #设置mariadb的密码

# mysql -uroot -p
create database discuz charset=utf8;        #创建discuz数据库
grant all on discuz.* to discuz@&#39;localhost&#39; identified by &quot;123456&quot;;     #授权discuz用户访问数据库




cat &gt; /var/www/html/index.php &lt;&lt;EOF
&lt;?php
phpinfo();
?&gt;
EOF
访问 IP地址。

安装Discuz论坛

wget http://download.comsenz.com/DiscuzX/3.1/Discuz_X3.1_SC_UTF8.zip
unzip Discuz_X3.1_SC_UTF8.zip
cd Discuz_X3.1_SC_UTF8/
mv upload/* /var/www/html/
cd /var/www/html/
chmod 757 -R data/ uc_server/ uc_client/ config/
systemctl restart httpd.service
</pre></div>
</div>
<p>访问<code class="docutils literal notranslate"><span class="pre">http://192.168.6.13/install/</span></code></p>
<p><img alt="image0" src="../../_images/Discuz001.png" /></p>
</section>
</section>
</section>
<section id="id3">
<h2><a class="toc-backref" href="#id8"><span class="section-number">6.2.2. </span>LAMP企业架构拓展实战</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>LAMP架构拆分的目的用于缓解单台服务器的压力，可以将PHP、Mysql单独安装至多台服务器
</pre></div>
</div>
<p>实现LAP+MYSQL架构，MYSQL单独拆分出去。部署方式如下：
（1）YUM安装LAMP多机方案 在Apache Web服务器上只需执行如下代码：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">httpd</span> <span class="n">httpd</span><span class="o">-</span><span class="n">devel</span> <span class="n">php</span><span class="o">-</span><span class="n">devel</span> <span class="n">php</span> <span class="n">php</span><span class="o">-</span><span class="n">mysql</span>
</pre></div>
</div>
<p>在MySQL数据库服务器只需执行如下代码：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="o">-</span><span class="n">y</span> <span class="n">install</span> <span class="n">mysql</span><span class="o">-</span><span class="n">server</span> <span class="n">mysql</span> <span class="n">mysql</span><span class="o">-</span><span class="n">devel</span> <span class="n">mysql</span><span class="o">-</span><span class="n">libs</span>
</pre></div>
</div>
<p>（2）源码安装LAMP 多机方案。 源码安装LAMP 多机方式， Apache Web
服务与MySQL 数据库服务分别部署在不同 的服务器即可，PHP 与Apache
服务部署在一台服务器， PHP 编译参数时加人如下代码进 行LAMP 的整合，
mysqlnd 为PHP 远程连接MySQL 数据库服务器的一种方式。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">configure</span> <span class="o">--</span><span class="n">prefix</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="mi">10</span><span class="n">ca1</span><span class="o">/</span><span class="n">php5</span>
<span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">mysql</span><span class="o">=</span><span class="n">mysqlnd</span> \
<span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">mysqli</span><span class="o">=</span><span class="n">mysqlnd</span>\
<span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">pdo</span><span class="o">-</span><span class="n">mysql</span><span class="o">=</span><span class="n">mysqlnd</span>\
<span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">apxs2</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">apache</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">apxs</span>

<span class="n">make</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</section>
<section id="centos7yummysql5-7-22">
<h2><a class="toc-backref" href="#id9"><span class="section-number">6.2.3. </span>Centos7使用yum源安装mysql5.7.22</a><a class="headerlink" href="#centos7yummysql5-7-22" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>centos7使用yum源方式安装mysql5.7.22
[root@web ~]# rpm -ivh https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm

#检查mysql源是否安装成功
yum repolist enabled | grep &quot;mysql.*-community.*&quot;

#安装MySQL
[root@web ~]# yum -y install mysql-community-server

# 启动、重启MySQL
[root@web ~]# systemctl start mysqld
systemctl restart mysqld

#开机自启动
[root@web ~]# systemctl enable mysqld.service


#修改密码
[root@web ~]# cat /var/log/mysqld.log | grep password
2018-05-08T09:07:09.591079Z 1 [Note] A temporary password is generated for root@localhost: Ipuq?4#lWyo+
[root@web ~]# mysql -uroot -p
Enter password:
输入密码&quot;Ipuq?4#lWyo+&quot;,重置密码：

mysql&gt; set password = password(&#39;Admin#123!&#39;);
Query OK, 0 rows affected, 1 warning (0.01 sec)

或者
mysql&gt; ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;MyNewPass4!&#39;;

#注意：mysql5.7默认安装了密码安全检查插件（validate_password），默认密码检查策略要求密码必须包含：大小写字母、数字和特殊符号，并且长度不能少于8位。否则会提示ERROR 1819 (HY000): Your password does not satisfy the current policy


#创建输数据库，并赋予权限
mysql&gt; create database OMServer character set utf8 collate utf8_bin;
Query OK, 1 row affected (0.01 sec)
mysql&gt; grant all privileges on OMServer.* to omserver_user@&#39;%&#39; identified by &#39;Omserver_user123!&#39;;
Query OK, 0 rows affected, 1 warning (0.00 sec)
</pre></div>
</div>
<p>默认配置文件路径：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>配置文件：/etc/my.cnf
日志文件：/var/log//var/log/mysqld.log
服务启动脚本：/usr/lib/systemd/system/mysqld.service
socket文件：/var/run/mysqld/mysqld.pid
</pre></div>
</div>
</section>
<section id="id4">
<h2><a class="toc-backref" href="#id10"><span class="section-number">6.2.4. </span>忘记密码</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>如果忘记root密码，则按如下操作恢复：

在[mysqld]的段中加上一句：skip-grant-tables 保存并且退出vi。

mysql  -u root

update mysql.user set authentication_string=password(&#39;admin#123!&#39;) where user=&#39;root&#39; and Host = &#39;localhost&#39;;

flush privileges



修改密码策略
在/etc/my.cnf文件添加validate_password_policy配置，指定密码策略

# 选择0（LOW），1（MEDIUM），2（STRONG）其中一种，选择2需要提供密码字典文件
validate_password_policy=0
如果不需要密码策略，添加my.cnf文件中添加如下配置禁用即可：

validate_password = off
重新启动mysql服务使配置生效：

systemctl restart mysqld
</pre></div>
</div>
<p>参考文献</p>
<p><a class="reference external" href="https://www.cnblogs.com/ianduin/p/7679239.html">https://www.cnblogs.com/ianduin/p/7679239.html</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01.LAMP%E9%83%A8%E7%BD%B2.html" class="btn btn-neutral float-left" title="6.1. LAMP+WordPress环境" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="03.LAMP%2BRedis%E4%BC%81%E4%B8%9A%E5%AE%9E%E6%88%98.html" class="btn btn-neutral float-right" title="6.3. LAMP+Radis企业实战" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>